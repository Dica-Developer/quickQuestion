From 69fa0cefaa45913f14a78ed7ea05279e3154016d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Tobias=20Baunb=C3=A6k?= <freeall@gmail.com>
Date: Thu, 13 Nov 2014 14:05:49 +0100
Subject: [PATCH] Added HEAD method

---
 index.js             |  5 +----
 tests/test-routes.js | 11 +++++++++--
 2 files changed, 10 insertions(+), 6 deletions(-)

diff --git a/index.js b/index.js
index 23713d5..41e4b4d 100644
--- a/index.js
+++ b/index.js
@@ -2,7 +2,7 @@ var protein = require('protein');
 var murl = require('murl');
 var address = require('network-address');
 
-var METHODS = 'GET POST PUT DELETE PATCH OPTIONS'.split(' ');
+var METHODS = 'GET HEAD POST PUT DELETE PATCH OPTIONS'.split(' ');
 var ALIASES = {};
 
 ALIASES.all = METHODS;
@@ -17,9 +17,6 @@ var Root = function() {
 	this.servers = [];
 
 	this.on('request', function(request, response) {
-		if (request.method === 'HEAD') {
-			request.method = 'GET';
-		}
 		this.mixin(request, response);
 		this.route(request, response);
 	});
diff --git a/tests/test-routes.js b/tests/test-routes.js
index 198ce2e..5be4d74 100644
--- a/tests/test-routes.js
+++ b/tests/test-routes.js
@@ -37,9 +37,16 @@ app.post('/foo', function(req, res) {
 	res.end();
 });
 
+app.head('/foo', function(req, res) {
+	assert.equal(req.method, 'HEAD');
+	assert.equal(req.url, '/foo');
+	ran++;
+	res.end();
+});
+
 app.listen(9999, function() {
-	exec('curl localhost:9999; curl localhost:9999/foo; curl localhost:9999/foobar; curl localhost:9999/foo/bar; curl -X POST localhost:9999/foo', function() {
-		assert.equal(ran, 5);
+	exec('curl localhost:9999; curl localhost:9999/foo; curl localhost:9999/foobar; curl localhost:9999/foo/bar; curl -X POST localhost:9999/foo; curl -I localhost:9999/foo', function() {
+		assert.equal(ran, 6);
 		process.exit(0);
 	});
 });
-- 
1.9.3 (Apple Git-50)

